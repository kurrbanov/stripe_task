# Stripe Task

## Оглавление
1. [О проекте](#о-проекте)
2. [Как запустить проект в Docker](#как-запустить-проект-в-docker)
3. [Описание проекта](#описание-проекта)

## О проекте
В проекте представлено использование в Django StripeAPI для оплаты товаров.

## Как запустить проект в Docker?
#### Клонируйте репозиторий
Через SSH:
```
git clone git@github.com:kurrbanov/stripe_task.git
```
Через HTTPS:
```
git clone https://github.com/kurrbanov/stripe_task.git
```
#### Измените переменные окружения и переименуйте файл .env.example в .env
**Note**: Если у вас нет Stripe аккаунта, то [зарегистрируйте его](https://dashboard.stripe.com/) и укажите приватный и публичный ключ в .env

```
cp .env.example .env
```

#### Запустите приложение через docker-compose
```
docker-compose up -d --build
```
Подождите, пока поднимутся контейнеры, накатятся миграции и откройте в браузере **http://localhost:8000/**

## Описание проекта

#### Тестовый датасет
В файле ```server/fill_db.py``` находится скрипт, который автоматически заполняет приложение тестовыми данными. Он запускается через ```server/Dockerfile``` после миграций. Можно изменить в нём значения и заполнить с его помощью БД.  
_P.S. ```superuser``` создаётся там же. Его имя, пароль и email находятся в ```server/.env```_

#### Описание эндпоинтов
1: ```GET /```  
Возвращает HTML-страницу со всеми ```Item```, а также кнопку перехода в корзину с товарами.  

2: ```GET /item/&id```  
Возвращает HTML-страницу с информацией о конкретном ```Item```. В случае, если ```Item``` не существует, возвращает ```400 Bad Request```.

3: ```GET /buy/&id```  
Создаёт сессию с платёжом и перенаправляет на неё.

4: ```POST /add_to_order```  
Создаёт ```Order``` по сгенерированному ```uuid```. ```uuid``` сохраняется в сессии, является идентификатором ```Order```, удаляется через 24 часа.

5: ```GET /bucket```
Возвращает список ```Item```, которые связаны с ```Order```.

6: ```POST /bucket```
Принимает значение ```country = 'RU' | 'DE' | 'US'``` устанавливающий юрисдикцию, для последующего определения налоговой ставки.

7: ```GET /buy-bucket```  
Создаёт купоны(```Discount```), промокоды(```PromoCode```) и налоговые ставки(```Tax```) из базы данных в Stripe Dashboard. После чего создаёт сессию оплаты для ```Order```, в котором учитываются промокоды и налоговая ставка.

8: ```GET /success```
Возвращает HTML-страницу, уведомляющую об успешной оплате.

9: ```GET /cancel```
Возвращает HTML-страницу, уведомляющую об проблемах с оплатой.

10: ```POST /clear```  
Очищает корзину.